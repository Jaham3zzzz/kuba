
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KubaTik</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');
* {margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body {background:black;color:white;overflow-x:hidden;}

/* NAV */
nav {
  position:fixed; top:0;width:100%; background:rgba(0,0,0,0.8);
  backdrop-filter:blur(10px); display:flex; justify-content:center; align-items:center;
  padding:12px 20px; z-index:10; gap:20px;
}
nav h1 {font-size:16px;font-weight:600;background:linear-gradient(45deg,#ff0050,#00f2ea);-webkit-background-clip:text;color:transparent;}
.nav-buttons {display:flex; gap:15px;}
nav button {background:none;border:1px solid #555;padding:6px 12px;color:white;border-radius:8px;cursor:pointer;transition:0.3s;}
nav button:hover {background:#ff0050;border-color:#ff0050;}

/* FYP container */
.video-container {height:100vh;width:100%;scroll-snap-type:y mandatory;overflow-y:scroll;scroll-behavior:smooth;}
.video-wrapper {height:100vh;width:100%;scroll-snap-align:start;display:flex;justify-content:center;align-items:center;position:relative;}
video {max-height:100%;max-width:100%;object-fit:cover;filter:brightness(0.9);transition:transform 0.6s ease, filter 0.6s ease;border-radius:10px;cursor:pointer;}
.video-wrapper.active video {transform:scale(1.05); filter:brightness(1);}

/* overlays */
.overlay {position:absolute; right:20px; bottom:60px; display:flex; flex-direction:column; align-items:center; gap:20px; z-index:3;}
.icon {font-size:28px; background:rgba(255,255,255,0.1); padding:10px; border-radius:50%; cursor:pointer; transition:0.3s; user-select:none;}
.icon:hover {transform:scale(1.2); background:rgba(255,255,255,0.25);}
.liked {background:rgba(255,0,80,0.7); color:white;}

/* heart animation */
.heart-animation {position:absolute; top:50%; left:50%; transform:translate(-50%, -50%) scale(0); font-size:100px; color:#ff0050; opacity:0; pointer-events:none; transition: transform 0.4s ease, opacity 0.4s ease; z-index:2;}
.heart-animation.show-heart {transform:translate(-50%, -50%) scale(1.5); opacity:1;}

/* end message */
#endMessage {display:none; height:100vh; align-items:center; justify-content:center; font-size:24px; color:gray; text-align:center; padding:20px; display:flex;}

/* pause overlay */
.pause-overlay {position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); font-size:100px; color:white; opacity:0; pointer-events:none; transition:opacity 0.3s ease; z-index:2;}
.pause-overlay.show {opacity:0.8;}

/* progress bar */
.progress-bar-container {position:absolute; bottom:20px; left:5%; width:90%; height:3px; background: rgba(255,255,255,0.2); border-radius:2px; cursor:pointer; opacity:0; transition:opacity 0.3s ease; z-index:3;}
.video-wrapper:hover .progress-bar-container {opacity:1;}
.progress-bar {width:0%;height:100%;background:#ff0050;border-radius:2px;}

/* liked grid */
#likedSection {display:none; padding-top:60px; background:#111; min-height:100vh;}
#likedList {display:grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap:15px; padding:20px;}
.liked-video {width:100%; cursor:pointer; overflow:hidden; border-radius:10px;}
.liked-video video {width:100%; height:200px; object-fit:cover; display:block; border-radius:10px;}

/* modal player */
#modal {display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.95); z-index:999; justify-content:center; align-items:center; flex-direction:column;}
#modal video {width:100%; max-width:600px; max-height:90vh; object-fit:cover; border-radius:10px;}
#modal .close-btn {position:absolute; top:20px; right:20px; font-size:30px; color:white; cursor:pointer;}
</style>
</head>
<body>

<nav>
  <h1>KubaTik</h1>
  <div class="nav-buttons">
    <button id="viewFyp">FYP</button>
    <button id="viewLiked">❤️ Liked</button>
  </div>
</nav>

<div class="video-container" id="mainFeed"></div>
<div id="endMessage">You have reached the end, more videos coming soon.</div>

<div id="likedSection">
  <h2 style="text-align:center;margin-bottom:20px;color:white;">❤️ Your Liked Videos</h2>
  <div id="likedList"></div>
</div>

<div id="modal">
  <div class="close-btn">✖</div>
  <video controls autoplay></video>
</div>

<script>
const videoFiles = [
  "videos/vid1.mp4",
  "videos/vid2.mp4",
  "videos/vid3.mp4",
  "videos/vid4.mp4",
  "videos/vid5.mp4",
  "videos/vid6.mp4"
];

const mainFeed = document.getElementById("mainFeed");
const likedSection = document.getElementById("likedSection");
const likedList = document.getElementById("likedList");
const viewFypBtn = document.getElementById("viewFyp");
const viewLikedBtn = document.getElementById("viewLiked");
const endMessage = document.getElementById("endMessage");

const modal = document.getElementById("modal");
const modalVideo = modal.querySelector("video");
const closeBtn = modal.querySelector(".close-btn");

let likedVideos = JSON.parse(localStorage.getItem("likedVideos")) || [];
let watchedVideos = JSON.parse(localStorage.getItem("watchedVideos")) || [];

// Populate FYP
function populateFYP() {
  mainFeed.innerHTML = '';
  const fypVideos = videoFiles.filter(v => !watchedVideos.includes(v) && !likedVideos.includes(v));
  if(fypVideos.length === 0){
    mainFeed.style.display = "none";
    endMessage.style.display = "flex";
    return;
  }
  fypVideos.forEach(src=>{
    const wrapper = document.createElement("div");
    wrapper.className = "video-wrapper";
    wrapper.dataset.src = src;
    const isLiked = likedVideos.includes(src);
    wrapper.innerHTML = `
      <video src="${src}" loop autoplay playsinline></video>
      <div class="overlay"><div class="icon like-btn ${isLiked ? 'liked' : ''}">❤️</div></div>
      <div class="pause-overlay">⏸</div>
      <div class="heart-animation">❤️</div>
      <div class="progress-bar-container"><div class="progress-bar"></div></div>
    `;
    mainFeed.appendChild(wrapper);
  });
  observeVideos();
  addVideoControls();
}

// Observer
let observer;
function observeVideos(){
  if(observer) observer.disconnect();
  observer = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
      const video = entry.target.querySelector("video");
      const src = entry.target.dataset.src;
      if(entry.isIntersecting){
        entry.target.classList.add("active");
        video.muted = false;
        video.play().catch(()=>{});
        if(!watchedVideos.includes(src)){
          watchedVideos.push(src);
          localStorage.setItem("watchedVideos", JSON.stringify(watchedVideos));
        }
      } else {
        entry.target.classList.remove("active");
        video.pause();
      }
    });
  }, {threshold:0.7});
  document.querySelectorAll(".video-wrapper").forEach(w => observer.observe(w));
}

// Controls
function addVideoControls(){
  document.querySelectorAll(".video-wrapper").forEach(wrapper=>{
    const video = wrapper.querySelector("video");
    const pauseOverlay = wrapper.querySelector(".pause-overlay");
    const progressBar = wrapper.querySelector(".progress-bar");
    const progressContainer = wrapper.querySelector(".progress-bar-container");
    const heartAnim = wrapper.querySelector(".heart-animation");
    const likeBtn = wrapper.querySelector(".like-btn");

    video.addEventListener("timeupdate", ()=>{if(video.duration>0) progressBar.style.width = (video.currentTime/video.duration*100) + "%";});
    progressContainer.addEventListener("click", e=>{video.currentTime = ((e.clientX - progressContainer.getBoundingClientRect().left)/progressContainer.offsetWidth)*video.duration;});

    video.addEventListener("click", ()=>{
      if(video.paused){ video.play(); pauseOverlay.textContent='▶️'; }
      else { video.pause(); pauseOverlay.textContent='⏸'; }
      pauseOverlay.classList.add("show");
      setTimeout(()=>pauseOverlay.classList.remove("show"),500);
    });

    likeBtn.addEventListener("click", ()=>{
      const src = wrapper.dataset.src;
      if(!likedVideos.includes(src)){
        likedVideos.push(src);
        likeBtn.classList.add("liked");
      } else {
        likedVideos = likedVideos.filter(v => v !== src);
        likeBtn.classList.remove("liked");
      }
      localStorage.setItem("likedVideos", JSON.stringify(likedVideos));
      heartAnim.classList.add("show-heart");
      setTimeout(()=>heartAnim.classList.remove("show-heart"),800);
    });
  });
}

// Liked Section
function renderLikedGrid(){
  likedList.innerHTML = '';
  if(likedVideos.length === 0){
    likedList.innerHTML = '<p style="text-align:center;opacity:0.6;">No liked videos yet.</p>';
    return;
  }
  likedVideos.forEach(src=>{
    const div = document.createElement("div");
    div.className = "liked-video";
    div.innerHTML = `<video src="${src}" muted></video>`;
    div.addEventListener("click", ()=>{modal.style.display = "flex"; modalVideo.src = src; modalVideo.play();});
    likedList.appendChild(div);
  });
}

// Buttons
viewFypBtn.addEventListener("click", ()=>{likedSection.style.display="none"; mainFeed.style.display="block"; endMessage.style.display="none"; populateFYP();});
viewLikedBtn.addEventListener("click", ()=>{mainFeed.style.display="none"; endMessage.style.display="none"; likedSection.style.display="block"; renderLikedGrid();});
closeBtn.addEventListener("click", ()=>{modal.style.display="none"; modalVideo.pause(); modalVideo.src="";});

populateFYP();
</script>
</body>
</html>
